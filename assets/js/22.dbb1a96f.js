(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{468:function(a,e,t){"use strict";t.r(e);var n=t(2),s=Object(n.a)({},(function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"lerna、bit调研"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lerna、bit调研"}},[a._v("#")]),a._v(" lerna、bit调研")]),a._v(" "),t("blockquote",[t("p",[a._v("对于维护过多个package来说，都会遇到一个问题：这些package是放在一个仓库里维护还是放在多个仓库里单独维护，数量较少的时候，多个仓库维护不会有太大问题，但是当package数量逐渐增多时，一些问题逐渐暴露出来,尤其是版本管理")])]),a._v(" "),t("h2",{attrs:{id:"lerna-yarn-workspace"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lerna-yarn-workspace"}},[a._v("#")]),a._v(" lerna + yarn workspace")]),a._v(" "),t("ul",[t("li",[a._v("yarn worksapce")])]),a._v(" "),t("h4",{attrs:{id:"什么是yarn-workspace"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是yarn-workspace"}},[a._v("#")]),a._v(" 什么是yarn workspace")]),a._v(" "),t("p",[a._v("yarn workspace 是软件包体系结构的一种新方式, 相对yarn link来说，只影响工作区的依赖树，而不会影响整个系统\n各个库之间存在依赖，如a依赖于b，因此我们通常需要将b link到a的node_module里，一旦仓库很多的话，手动的管理这些link操作负担很大，因此需要自动化的link操作，按照拓扑排序将各个依赖进行link")]),a._v(" "),t("p",[a._v("加入一个项目的目录结构如下：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("├── packages\n|   ├── a\n|   |   ├── package.json\n|   ├── b\n|   |   ├── package.json\n├── package.json\n")])])]),t("h4",{attrs:{id:"yarn-workspace-如何使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#yarn-workspace-如何使用"}},[a._v("#")]),a._v(" yarn workspace 如何使用")]),a._v(" "),t("p",[a._v("在 package.json 文件中添加以下内容")]),a._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"private"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 支持通配符   [package/*]")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"workspaces"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"package/a"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"package/b"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n")])])]),t("p",[a._v("// 在lerna.json内增加如下内容以在lerna内启用yarn workspaces")]),a._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"npmClient"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"yarn"')]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"useWorkspaces"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("ul",[t("li",[a._v("lerna")])]),a._v(" "),t("h4",{attrs:{id:"常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[a._v("#")]),a._v(" 常用命令")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("// 安装所有依赖项并链接任何交叉依赖项\nlerna bootstrap \n//例: lerna bootstrap --npm-client "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("yarn")]),a._v(" --use-workspaces\n// 在每个包中执行任意命令\nlerna "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v("\n//例: lerna "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'yarn remove lodash'")]),a._v(" // 删除\n\nlerna "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v("        // 安装依赖，支持交叉依赖\n// lerna "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" packageA --scope"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("packageB\n\n// 版本发布\nlerna changed    // 检查自上次发布以来哪些软件包已经更新\nlerna "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("diff")]),a._v("       // 自上次发布以来，对所有包或单个包进行区分\nlerna publish    // 发布版本\n\n// 常用\nlerna clean      // 清除项目中所有 node_modules\nlerna init       // 初始化项目\nlerna create     // 创建项目中的子package\n\n// 其它\nlerna run        // 在包含该脚本的包中运行 "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" 脚本\nlerna info       // 查看信息\nlerna "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("import")]),a._v("     // 导入\nlerna "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("link")]),a._v("       // 软链\nlerna version    // 查看版本\nlerna "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v("         // 列出当前 lerna 项目中的公共包\nlerna updated    // 检查更新\n")])])]),t("h4",{attrs:{id:"模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#模式"}},[a._v("#")]),a._v(" 模式")]),a._v(" "),t("p",[a._v("lerna有两种模式")]),a._v(" "),t("ol",[t("li",[a._v("fixed模式下，模块发布新版本时，都会升级到leran.json里编写的version字段")]),a._v(" "),t("li",[a._v("independent模式下，模块发布新版本时，会逐个询问需要升级的版本号，基准版本为它自身的package.json，这样就避免了上述问题。")])]),a._v(" "),t("h4",{attrs:{id:"lerna工作流"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lerna工作流"}},[a._v("#")]),a._v(" lerna工作流")]),a._v(" "),t("ul",[t("li",[a._v("安装lerna")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("yarn")]),a._v(" global "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" lerna \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 或")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" i -g lerna\n")])])]),t("ul",[t("li",[a._v("初始化项目")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("lerna init\n")])])]),t("p",[a._v("执行初始化命令后会生成一个目录")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("- packages(目录)\n- lerna.json(配置文件)\n- package.json(工程描述文件)\n")])])]),t("p",[a._v("在lerna.json中修改version字段 设置为独立模式")]),a._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"packages"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"packages/*"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"version"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"independent"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"npmClient"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"yarn"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"useWorkspaces"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("ul",[t("li",[a._v("在package中增加模块")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("执行\n lerna create demo-ui\n lerna create demo-core\n")])])]),t("p",[a._v("生成以下目录")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("packages\n├─demo-ui\n|    ├─README.md\n|    ├─package-lock.json\n|    ├─package.json\n|    ├─lib\n|    |  └demo-ui.js\n|    ├─__tests__\n|    |     └demo-ui.test.js\n├─demo-core\n|     ├─README.md\n|     ├─package-lock.json\n|     ├─package.json\n|     ├─lib\n|     |  └demo-core.js\n|     ├─__tests__\n|     |     └demo-core.test.js\n")])])]),t("p",[a._v("当demo-ui 依赖demo-core执行")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("lerna add demo-core --scope=demo-ui\n")])])]),t("p",[a._v("采取独立模式时 package中的包是独立版本的，可自行选择发布版本")]),a._v(" "),t("p",[a._v("比如，当修改demo-ui的时候 demo-core并没有受影响， 所以只需要发布demo-ui即可。反之，当修改demo-core的时候，由于demo-ui依赖demo-core。此时lerna会检查到依赖。当执行")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("lerna publish\n")])])]),t("p",[a._v("的时候，会同时升级demo-core和demo-ui的版本")]),a._v(" "),t("h4",{attrs:{id:"优缺点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优缺点"}},[a._v("#")]),a._v(" 优缺点")]),a._v(" "),t("ul",[t("li",[a._v("优点：")])]),a._v(" "),t("ol",[t("li",[a._v("方便版本控制和本地调试")]),a._v(" "),t("li",[a._v("方便changelog生成")])]),a._v(" "),t("ul",[t("li",[a._v("缺点：")])]),a._v(" "),t("ol",[t("li",[a._v("重构成本较高， 需对依赖手动进行分析")]),a._v(" "),t("li",[a._v("仓库体积变大")])]),a._v(" "),t("h2",{attrs:{id:"bit"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bit"}},[a._v("#")]),a._v(" bit")]),a._v(" "),t("blockquote",[t("p",[a._v("Bit是一个工具，可以在不同项目 共享 与 同步 组件。")])]),a._v(" "),t("h4",{attrs:{id:"bit的优势"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bit的优势"}},[a._v("#")]),a._v(" bit的优势")]),a._v(" "),t("ul",[t("li",[a._v("使用Bit我们依旧可以保证应用程序的开发进度，同时提取可复用的组件以供重用")]),a._v(" "),t("li",[a._v("公共组件、代码片段便捷发布")]),a._v(" "),t("li",[a._v("公共组件、代码片段便捷导入")]),a._v(" "),t("li",[a._v("公共组件、代码片段版本控制")]),a._v(" "),t("li",[a._v("公共组件、代码片段快速索引及选用（实时编译、实时预览）")]),a._v(" "),t("li",[a._v("公共组件、代码片段自动测试执行")]),a._v(" "),t("li",[a._v("公共组件、代码片段文档生成")]),a._v(" "),t("li",[a._v("结合配置CI自动完成NPM发布")]),a._v(" "),t("li",[a._v("标准化开发规范")])]),a._v(" "),t("h4",{attrs:{id:"环境准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境准备"}},[a._v("#")]),a._v(" 环境准备")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("npm i -g bit-bin\n")])])]),t("h4",{attrs:{id:"bit常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bit常用命令"}},[a._v("#")]),a._v(" bit常用命令")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("start a working area\n  init               Create or reinitialize an empty Bit scope or reinitialize an existing one\n\nDevelop components\n  tag                Record component changes and lock versions.\n  status             Show the working area component(s) status.\n  add                Add any subset of files to be tracked as a component(s).\n  untrack            Untrack a new component(s).\n  untag              Revert versions tagged for component(s).\n  move               Move a component to a different filesystem path.\n  checkout           Switch between component versions.\n  merge              Merge changes of different component versions.\n  diff               Show diff between components files.\n  install            install all component dependencies\n\nCollaborate on components\n  import             import components into your current working area.\n  export             export components to a remote scope.\n  remote             Manage set of tracked bit scope(s).\n  link               Generate symlinks for imported components absolute path resolution.\n  remove             Remove component(s) from your working area, or a remote scope.\n  deprecate          Deprecate a component\n  undeprecate        Undeprecate a deprecated component\n  eject              Replaces the components from the local scope with the corresponding packages.\n  pack               Create tar for npm publish\n\nExplore components\n  list               list components on a local or a remote scope.\n  graph              EXPERIMENTAL. generate an image file with the dependencies graph.\n\nWorkspace commands\n  config             global config management\n  clear-cache        clears Bit's cache from current working machine\n  scope-config       local scope config management\n  login              log the CLI into bit.dev\n  logout             log the CLI out of bit.dev\n  doctor             diagnose a bit workspace\n\nView components\n  show               show component overview.\n  log                show components(s) version history.\n\ncomponent environment operations\n  test               test any set of components with configured tester (component tester or as defined in bit.json)\n  build              build any set of components with configured compiler (component compiler or as defined in bit.json)\n  watch              watch a set of components\n")])])]),t("h4",{attrs:{id:"bit工作流"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bit工作流"}},[a._v("#")]),a._v(" bit工作流")]),a._v(" "),t("ol",[t("li",[a._v("项目初始化")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("bit init\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("导出组件")])]),a._v(" "),t("p",[a._v("在项目中编写组件完成后, 导出组件")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("bit add [files] --id [namespace]/[id]\nbit tag [id] [version]\nbit export owner.collection/[namespace]/[id]\n")])])]),t("ol",{attrs:{start:"3"}},[t("li",[a._v("引入组件")])]),a._v(" "),t("p",[a._v("在项目中使用bit组件时 也需要初始化bit工作区。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("bit import owner.collection/[namespace]/[id]\n")])])]),t("ol",{attrs:{start:"4"}},[t("li",[a._v("修改、合并、再导出")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("bit import --merge ours\nbit import owner.collection/[namespace]/[id][@version] --merge manual\n// 手动指定版本\nbit tag owner.collection/[namespace]/[id] [version]\n// 自动加一：--patch or --minor or --major\nbit tag owner.collection/[namespace]/[id] --patch\nbit export owner.collection\n")])])]),t("ol",{attrs:{start:"5"}},[t("li",[a._v("版本管理")])]),a._v(" "),t("p",[a._v("当对存储库中的一个组件进行更改时，Bit将自动跟踪更改并识别将其用作依赖项的其他组件。然后，如果运行，bit status将看到所有组件，因为它们的依赖关系已被修改，这些组件已自动修改。无需手动处理package.json文件即可管理对依赖项的更改")]),a._v(" "),t("h4",{attrs:{id:"优缺点-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优缺点-2"}},[a._v("#")]),a._v(" 优缺点")]),a._v(" "),t("ul",[t("li",[a._v("优点：")])]),a._v(" "),t("ol",[t("li",[a._v("重构成本低")]),a._v(" "),t("li",[a._v("自动管理仓库中的所有依赖关系，包括对组件依赖关系的更改，并根据需要更新所有组件。没有其他package.json文件可以维护或更新。")]),a._v(" "),t("li",[a._v("也可以通过导入任何组件，进行更改并向原始存储库发布更新来从任何其他存储库中发布组件更新。")])]),a._v(" "),t("ul",[t("li",[a._v("缺点：")])]),a._v(" "),t("ol",[t("li",[a._v("文档较少，遇到问题可能不好解决")]),a._v(" "),t("li",[a._v("比较适合以组件为单位的库")])])])}),[],!1,null,null,null);e.default=s.exports}}]);